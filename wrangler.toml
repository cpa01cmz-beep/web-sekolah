"$schema" = "./node_modules/wrangler/config-schema.json"
name = "website-sekolah"
main = "worker/index.ts"
compatibility_date = "2026-02-18"
compatibility_flags = ["nodejs_compat"]
send_metrics = false

[assets]
directory = "dist/client"
not_found_handling = "single-page-application"
run_worker_first = ["/api/*", "!/api/docs/*"]

[observability]
enabled = true
head_sampling_rate = 0.1

[triggers]
crons = ["* * * * *"]

[limits]
cpu_ms = 50

[placement]
mode = "smart"

[[durable_objects.bindings]]
name = "GlobalDurableObject"
class_name = "GlobalDurableObject"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["GlobalDurableObject"]

[env.staging]
name = "website-sekolah-staging"
keep_vars = true
logpush = true
vars = { ENVIRONMENT = "staging" }

[env.staging.triggers]
crons = ["* * * * *"]

[env.staging.limits]
cpu_ms = 50

[env.staging.placement]
mode = "smart"

[env.staging.observability]
enabled = true
head_sampling_rate = 0.2

[[env.staging.durable_objects.bindings]]
name = "GlobalDurableObject"
class_name = "GlobalDurableObject"

[[env.staging.migrations]]
tag = "v1"
new_sqlite_classes = ["GlobalDurableObject"]

[env.production]
name = "website-sekolah-production"
workers_dev = false
keep_vars = true
vars = { ENVIRONMENT = "production" }
logpush = true

[env.production.triggers]
crons = ["* * * * *"]

[env.production.limits]
cpu_ms = 50

[env.production.placement]
mode = "smart"

[env.production.observability]
enabled = true
head_sampling_rate = 0.05

[[env.production.durable_objects.bindings]]
name = "GlobalDurableObject"
class_name = "GlobalDurableObject"

[[env.production.migrations]]
tag = "v1"
new_sqlite_classes = ["GlobalDurableObject"]
